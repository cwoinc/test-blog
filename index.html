
<!DOCTYPE html>
<!-- saved from url=(0050)http://www.runoob.com/w3cnote/shell-scripting.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
  <meta property="qc:admins" content="465267610762567726375">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Shell脚本编程初体验 | 菜鸟教程</title>

  <link rel="dns-prefetch" href="http://s.w.org/">
<link rel="canonical" href="http://www.runoob.com/w3cnote/shell-scripting.html">
<meta name="keywords" content="Shell脚本编程初体验">
<meta name="description" content="通常，当人们提到“shell脚本语言”时，浮现在他们脑海中是bash，ksh，sh或者其它相类似的linux/unix脚本语言。脚本语言是与计算机交流的另外一种途径。使用图形化窗口界面（不管是windows还是linux都无所谓）用户可以移动鼠标并点击各种对象，比如按钮、列表、选框等等。但这种方式在每次用户想要计算机/服务器完成相同任务时（比如说批量转换照片，或者下载新的电影、mp3等）却是十分不方便。要想让所有这些事情变得简单并且自动..">
		
	<link rel="shortcut icon" href="http://static.runoob.com/images/favicon.ico" mce_href="//static.runoob.com/images/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="./Shell脚本编程初体验 _ 菜鸟教程_files/style.css" type="text/css" media="all">	
	<link rel="stylesheet" href="./Shell脚本编程初体验 _ 菜鸟教程_files/font-awesome.min.css" media="all">	
  <!--[if gte IE 9]><!-->
  <script src="./Shell脚本编程初体验 _ 菜鸟教程_files/hm.js.下载"></script><script src="./Shell脚本编程初体验 _ 菜鸟教程_files/jquery.min.js.下载"></script>
  <!--<![endif]-->
  <!--[if lt IE 9]>
     <script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
     <script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script>
  <![endif]-->
  <link rel="apple-touch-icon" href="http://static.runoob.com/images/icon/mobile-icon.png">
  <meta name="apple-mobile-web-app-title" content="菜鸟教程">
<link rel="stylesheet" type="text/css" href="./Shell脚本编程初体验 _ 菜鸟教程_files/prettify.css"><style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
.en-markup-crop-options {
    top: 18px !important;
    left: 50% !important;
    margin-left: -100px !important;
    width: 200px !important;
    border: 2px rgba(255,255,255,.38) solid !important;
    border-radius: 4px !important;
}

.en-markup-crop-options div div:first-of-type {
    margin-left: 0px !important;
}
</style></head>
<body style="">

<!--  头部 -->
<div class="container logo-search">

  <div class="col search row-search-mobile">
    <form action="http://www.runoob.com/w3cnote/index.php">
      <input class="placeholder" value="搜索……" name="s" autocomplete="off">
    </form>
  </div>

  <div class="row">
    <div class="col logo">
      <h1><a href="http://www.runoob.com/">菜鸟教程 -- 学的不仅是技术，更是梦想！</a></h1>
    </div>
        <div class="col right-list"> 
    <button class="btn btn-responsive-nav btn-inverse" data-toggle="collapse" data-target=".nav-main-collapse" id="pull" style=""> <i class="fa fa-navicon"></i> </button>
    </div>
        <div class="col search search-desktop last">
      <form action="http://www.runoob.com/" target="_blank">
        <input class="placeholder" id="s" name="s" value="搜索……" autocomplete="off">
      </form>
    </div>
  </div>
</div>


<!-- 导航栏 -->
<div class="container navigation">
	<div class="row">
		<div class="col nav">
			

						<ul class="pc-nav" id="note-nav">
				<li><a href="http://www.runoob.com/">首页</a></li>
				<li><a href="http://www.runoob.com/w3cnote">笔记首页</a></li>
				<li><a href="http://www.runoob.com/w3cnote_genre/android" title="Android 基础入门教程">Android</a></li>
				<li><a href="http://www.runoob.com/w3cnote_genre/net-2" title="互联网">互联网</a></li>
				<li><a href="http://www.runoob.com/w3cnote_genre/disorganized" title="杂乱无章">杂乱无章</a></li>
				<li><a href="http://www.runoob.com/w3cnote_genre/tech" title="科技资讯">科技资讯</a></li>
				<li><a href="http://www.runoob.com/w3cnote_genre/coderlife" title="程序员人生">程序员人生</a></li>
				<li><a href="http://www.runoob.com/w3cnote_genre/joke" title="程序员笑话">程序员笑话</a></li>
				<li><a href="http://www.runoob.com/w3cnote_genre/code" title="编程技术">编程技术</a></li> 
			</ul>
						
      		
			<ul class="mobile-nav">
				<li><a href="http://www.runoob.com/w3cnote">首页</a></li>
				<li><a href="http://www.runoob.com/w3cnote_genre/android" target="_blank" title="Android 基础入门教程">Android</a></li>
				<li><a href="http://www.runoob.com/w3cnote_genre/coderlife" target="_blank" title="程序员人生">鸡汤</a></li>
				<li><a href="http://www.runoob.com/w3cnote_genre/joke" target="_blank" title="程序员笑话">逗乐</a></li>
				
				<a href="javascript:void(0)" class="search-reveal">Search</a> 
			</ul>
			
		</div>
	</div>
</div>


<!--  内容  -->
<div class="container main">
	<div class="row">

		<div class="col middle-column big-middle-column">
	 			<div class="article">
			<div class="article-heading">
				<h2>Shell脚本编程初体验</h2>				<h3><em>分类</em> <a href="http://www.runoob.com/w3cnote_genre/code" title="编程技术">编程技术</a> </h3>
			</div>
			<div class="article-body">
				<div class="article-intro">
					<p>通常，当人们提到"shell脚本语言"时，浮现在他们脑海中是bash，ksh，sh或者其它相类似的linux/unix脚本语言。脚本语言是与计算机交流的另外一种途径。使用图形化窗口界面（不管是windows还是linux都无所谓）用户可以移动鼠标并点击各种对象，比如按钮、列表、选框等等。但这种方式在每次用户想要计算机/服务器完成相同任务时（比如说批量转换照片，或者下载新的电影、mp3等）却是十分不方便。要想让所有这些事情变得简单并且自动化，我们可以使用shell脚本。</p>
<p>某些编程语言，像pascal、foxpro、C、java之类，在执行前需要先进行编译。它们需要合适的编译器来让我们的代码完成某个任务。</p>
<p><img class="aligncenter" src="./Shell脚本编程初体验 _ 菜鸟教程_files/113720s46pren00n2681cr.jpg" alt="Shell脚本编程初体验" width="500" height="375"></p>
<p>而其它一些编程语言，像php、javascript、visualbasic之类，则不需要编译器，因此它们需要解释器，而我们不需要编译代码就可以运行程序。</p>
<p>shell脚本也像解释器一样，但它通常用于调用外部已编译的程序。然后，它会捕获输出结果、退出代码并根据情况进行处理。</p>
<p>Linux世界中最为流行的shell脚本语言之一，就是bash。而我认为（这是我自己的看法）原因在于，默认情况下bash shell可以让用户便捷地通过历史命令（先前执行过的）导航，与之相反的是，ksh则要求对.profile进行一些调整，或者记住一些"魔术"组合键来查阅历史并修正命令。</p>
<p>好了，我想这些介绍已经足够了，剩下来哪个环境最适合你，就留给你自己去判断吧。从现在开始，我将只讲bash及其脚本。在下面的例子中，我将使用CentOS 6.6和bash-4.1.2。请确保你有相同版本，或者更高版本。</p>
<h2>Shell脚本流</h2>
<p>shell脚本语言就跟和几个人聊天类似。你只需把所有命令想象成能帮你做事的那些人，只要你用正确的方式来请求他们去做。比如说，你想要写文档。首先，你需要纸。然后，你需要把内容说给某个人听，让他帮你写。最后，你想要把它存放到某个地方。或者说，你想要造一所房子，因而你需要请合适的人来清空场地。在他们说"事情干完了"，那么另外一些工程师就可以帮你来砌墙。最后，当这些工程师们也告诉你"事情干完了"的时候，你就可以叫油漆工来给房子粉饰了。如果你让油漆工在墙砌好前就来粉饰，会发生什么呢？我想，他们会开始发牢骚了。几乎所有这些像人一样的命令都会说话，如果它们完成了工作而没有发生什么问题，那么它们就会告诉"标准输出"。如果它们不能做你叫它们做的事——它们会告诉"标准错误"。这样，最后，所有的命令都通过"标准输入"来听你的话。</p>
<p>快速实例——当你打开linux终端并写一些文本时——你正通过"标准输入"和bash说话。那么，让我们来问问bash shell <strong>who am i（我是谁？）</strong>吧。</p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> who am i                                </span><span class="pun">&lt;---</span><span class="pln"> </span><span class="pun">你通过标准输入对</span><span class="pln"> bash shell </span><span class="pun">说</span><span class="pln">
root     pts</span><span class="pun">/</span><span class="lit">0</span><span class="pln">        </span><span class="lit">2015</span><span class="pun">-</span><span class="lit">04</span><span class="pun">-</span><span class="lit">22</span><span class="pln"> </span><span class="lit">20</span><span class="pun">:</span><span class="lit">17</span><span class="pln"> </span><span class="pun">(</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.123</span><span class="pun">)</span><span class="pln">     </span><span class="pun">&lt;---</span><span class="pln"> bash shell</span><span class="pun">通过标准输出回答你</span></pre>
<p>现在，让我们说一些bash听不懂的问题：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> blablabla           </span><span class="pun">&lt;---</span><span class="pln"> </span><span class="pun">哈，你又在和标准输入说话了</span><span class="pln">
</span><span class="pun">-</span><span class="pln">bash</span><span class="pun">:</span><span class="pln"> blablabla</span><span class="pun">:</span><span class="pln"> command </span><span class="kwd">not</span><span class="pln"> found     </span><span class="pun">&lt;---</span><span class="pln"> bash</span><span class="pun">通过标准错误在发牢骚了</span></pre>
<p>":"之前的第一个单词通常是向你发牢骚的命令。实际上，这些流中的每一个都有它们自己的索引号（LCTT 译注：文件句柄号）：</p>
<ul>
	
	<a href="task-time.md">fffffffffffffffffff</a>
	
<li>标准输入（<strong>stdin</strong>） – 0</li>
<li>标准输出（<strong>stdout</strong>） – 1</li>
<li>标准错误（<strong>stderr</strong>） – 2</li>
</ul>
<p>如果你真的想要知道哪个输出命令说了些什么——你需要将那次发言重定向到（在命令后使用大于号"&gt;"和流索引）文件：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> blablabla </span><span class="lit">1</span><span class="pun">&gt;</span><span class="pln"> output</span><span class="pun">.</span><span class="pln">txt
</span><span class="pun">-</span><span class="pln">bash</span><span class="pun">:</span><span class="pln"> blablabla</span><span class="pun">:</span><span class="pln"> command </span><span class="kwd">not</span><span class="pln"> found</span></pre>
<p>在本例中，我们试着重定向流1（<strong>stdout</strong>）到名为output.txt的文件。让我们来看对该文件内容所做的事情吧，使用cat命令可以做这事：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat output</span><span class="pun">.</span><span class="pln">txt
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>看起来似乎是空的。好吧，现在让我们来重定向流2（<strong>stderr</strong>）：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> blablabla </span><span class="lit">2</span><span class="pun">&gt;</span><span class="pln"> error</span><span class="pun">.</span><span class="pln">txt
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>好吧，我们看到牢骚话没了。让我们检查一下那个文件：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat error</span><span class="pun">.</span><span class="pln">txt
</span><span class="pun">-</span><span class="pln">bash</span><span class="pun">:</span><span class="pln"> blablabla</span><span class="pun">:</span><span class="pln"> command </span><span class="kwd">not</span><span class="pln"> found
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>果然如此！我们看到，所有牢骚话都被记录到errors.txt文件里头去了。</p>
<p>有时候，命令会同时产生<strong>stdout</strong>和<strong>stderr</strong>。要重定向它们到不同的文件，我们可以使用以下语句：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">command </span><span class="lit">1</span><span class="pun">&gt;</span><span class="kwd">out</span><span class="pun">.</span><span class="pln">txt </span><span class="lit">2</span><span class="pun">&gt;</span><span class="pln">err</span><span class="pun">.</span><span class="pln">txt</span></pre>
<p>要缩短一点语句，我们可以忽略"1"，因为默认情况下<strong>stdout</strong>会被重定向：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">command </span><span class="pun">&gt;</span><span class="kwd">out</span><span class="pun">.</span><span class="pln">txt </span><span class="lit">2</span><span class="pun">&gt;</span><span class="pln">err</span><span class="pun">.</span><span class="pln">txt</span></pre>
<p>好吧，让我们试试做些"坏事"。让我们用rm命令把file1和folder1给删了吧：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> rm </span><span class="pun">-</span><span class="pln">vf folder1 file1 </span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">txt </span><span class="lit">2</span><span class="pun">&gt;</span><span class="pln">err</span><span class="pun">.</span><span class="pln">txt</span></pre>
<p>现在来检查以下输出文件：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">txt
removed </span><span class="str">`file1'
[root@localhost ~]# cat err.txt
rm: cannot remove `</span><span class="pln">folder1</span><span class="str">': Is a directory
[root@localhost ~]#</span></pre>
<p>正如我们所看到的，不同的流被分离到了不同的文件。有时候，这也不是很方便，因为我们想要查看出现错误时，在某些操作前面或后面所连续发生的事情。要实现这一目的，我们可以重定向两个流到同一个文件：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">command </span><span class="pun">&gt;&gt;</span><span class="pln">out_err</span><span class="pun">.</span><span class="pln">txt </span><span class="lit">2</span><span class="pun">&gt;&gt;</span><span class="pln">out_err</span><span class="pun">.</span><span class="pln">txt</span></pre>
<p>注意：请注意，我使用"&gt;&gt;"替代了"&gt;"。它允许我们附加到文件，而不是覆盖文件。</p>
<p>我们也可以重定向一个流到另一个：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">command </span><span class="pun">&gt;</span><span class="pln">out_err</span><span class="pun">.</span><span class="pln">txt </span><span class="lit">2</span><span class="pun">&gt;&amp;</span><span class="lit">1</span></pre>
<p>让我来解释一下吧。所有命令的标准输出将被重定向到out_err.txt，错误输出将被重定向到流1（上面已经解释过了），而该流会被重定向到同一个文件。让我们看这个实例：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> rm </span><span class="pun">-</span><span class="pln">fv folder2 file2 </span><span class="pun">&gt;</span><span class="pln">out_err</span><span class="pun">.</span><span class="pln">txt </span><span class="lit">2</span><span class="pun">&gt;&amp;</span><span class="lit">1</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat out_err</span><span class="pun">.</span><span class="pln">txt
rm</span><span class="pun">:</span><span class="pln"> cannot remove </span><span class="str">`folder2': Is a directory
removed `</span><span class="pln">file2</span><span class="str">'
[root@localhost ~]#</span></pre>
<p>看着这些组合的输出，我们可以将其说明为：首先，<strong>rm</strong>命令试着将folder2删除，而它不会成功，因为linux要求<strong>-r</strong>键来允许<strong>rm</strong>命令删除文件夹，而第二个file2会被删除。通过为<strong>rm</strong>提供<strong>-v</strong>（详情）键，我们让rm命令告诉我们每个被删除的文件或文件夹。</p>
<p>这些就是你需要知道的，关于重定向的几乎所有内容了。我是说几乎，因为还有一个更为重要的重定向工具，它称之为"管道"。通过使用|（管道）符号，我们通常重定向<strong>stdout</strong>流。</p>
<p>比如说，我们有这样一个文本文件：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat text_file</span><span class="pun">.</span><span class="pln">txt
</span><span class="typ">This</span><span class="pln"> line does </span><span class="kwd">not</span><span class="pln"> contain H e l l o  word
</span><span class="typ">This</span><span class="pln"> lilne contains </span><span class="typ">Hello</span><span class="pln">
</span><span class="typ">This</span><span class="pln"> also containd </span><span class="typ">Hello</span><span class="pln">
</span><span class="typ">This</span><span class="pln"> one </span><span class="kwd">no</span><span class="pln"> due to HELLO all capital
</span><span class="typ">Hello</span><span class="pln"> bash world</span><span class="pun">!</span></pre>
<p>而我们需要找到其中某些带有"Hello"的行，Linux中有个<strong>grep</strong>命令可以完成该工作：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> grep </span><span class="typ">Hello</span><span class="pln"> text_file</span><span class="pun">.</span><span class="pln">txt
</span><span class="typ">This</span><span class="pln"> lilne contains </span><span class="typ">Hello</span><span class="pln">
</span><span class="typ">This</span><span class="pln"> also containd </span><span class="typ">Hello</span><span class="pln">
</span><span class="typ">Hello</span><span class="pln"> bash world</span><span class="pun">!</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>当我们有个文件，想要在里头搜索的时候，这用起来很不错。当如果我们需要在另一个命令的输出中查找某些东西，这又该怎么办呢？是的，当然，我们可以重定向输出到文件，然后再在文件里头查找：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> fdisk </span><span class="pun">-</span><span class="pln">l</span><span class="pun">&gt;</span><span class="pln">fdisk</span><span class="pun">.</span><span class="kwd">out</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> grep </span><span class="str">"Disk /dev"</span><span class="pln"> fdisk</span><span class="pun">.</span><span class="kwd">out</span><span class="pln">
</span><span class="typ">Disk</span><span class="pln"> </span><span class="pun">/</span><span class="pln">dev</span><span class="pun">/</span><span class="pln">sda</span><span class="pun">:</span><span class="pln"> </span><span class="lit">8589</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> </span><span class="lit">8589934592</span><span class="pln"> bytes
</span><span class="typ">Disk</span><span class="pln"> </span><span class="pun">/</span><span class="pln">dev</span><span class="pun">/</span><span class="pln">mapper</span><span class="pun">/</span><span class="typ">VolGroup</span><span class="pun">-</span><span class="pln">lv_root</span><span class="pun">:</span><span class="pln"> </span><span class="lit">7205</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7205814272</span><span class="pln"> bytes
</span><span class="typ">Disk</span><span class="pln"> </span><span class="pun">/</span><span class="pln">dev</span><span class="pun">/</span><span class="pln">mapper</span><span class="pun">/</span><span class="typ">VolGroup</span><span class="pun">-</span><span class="pln">lv_swap</span><span class="pun">:</span><span class="pln"> </span><span class="lit">855</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> </span><span class="lit">855638016</span><span class="pln"> bytes
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>如果你打算grep一些双引号引起来带有空格的内容呢！</p>
<p>注意：fdisk命令显示关于Linux操作系统磁盘驱动器的信息。</p>
<p>就像我们看到的，这种方式很不方便，因为我们不一会儿就把临时文件空间给搞乱了。要完成该任务，我们可以使用管道。它们允许我们重定向一个命令的<strong>stdout</strong>到另一个命令的<strong>stdin</strong>流：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> fdisk </span><span class="pun">-</span><span class="pln">l </span><span class="pun">|</span><span class="pln"> grep </span><span class="str">"Disk /dev"</span><span class="pln">
</span><span class="typ">Disk</span><span class="pln"> </span><span class="pun">/</span><span class="pln">dev</span><span class="pun">/</span><span class="pln">sda</span><span class="pun">:</span><span class="pln"> </span><span class="lit">8589</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> </span><span class="lit">8589934592</span><span class="pln"> bytes
</span><span class="typ">Disk</span><span class="pln"> </span><span class="pun">/</span><span class="pln">dev</span><span class="pun">/</span><span class="pln">mapper</span><span class="pun">/</span><span class="typ">VolGroup</span><span class="pun">-</span><span class="pln">lv_root</span><span class="pun">:</span><span class="pln"> </span><span class="lit">7205</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7205814272</span><span class="pln"> bytes
</span><span class="typ">Disk</span><span class="pln"> </span><span class="pun">/</span><span class="pln">dev</span><span class="pun">/</span><span class="pln">mapper</span><span class="pun">/</span><span class="typ">VolGroup</span><span class="pun">-</span><span class="pln">lv_swap</span><span class="pun">:</span><span class="pln"> </span><span class="lit">855</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> </span><span class="lit">855638016</span><span class="pln"> bytes
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>如你所见，我们不需要任何临时文件就获得了相同的结果。我们把<strong>fdisk stdout</strong>重定向到了<strong>grep stdin</strong>。</p>
<p><strong>注意</strong> ： 管道重定向总是从左至右的。</p>
<p>还有几个其它重定向，但是我们将把它们放在后面讲。</p>
<h2>在shell中显示自定义信息</h2>
<p>正如我们所知道的，通常，与shell的交流以及shell内的交流是以对话的方式进行的。因此，让我们创建一些真正的脚本吧，这些脚本也会和我们讲话。这会让你学到一些简单的命令，并对脚本的概念有一个更好的理解。</p>
<p>假设我们是某个公司的总服务台经理，我们想要创建某个shell脚本来注册呼叫信息：电话号码、用户名以及问题的简要描述。我们打算把这些信息存储到普通文本文件data.txt中，以便今后统计。脚本它自己就是以对话的方式工作，这会让总服务台的工作人员的小日子过得轻松点。那么，首先我们需要显示提问。对于显示信息，我们可以用echo和printf命令。这两个都是用来显示信息的，但是printf更为强大，因为我们可以通过它很好地格式化输出，我们可以让它右对齐、左对齐或者为信息留出专门的空间。让我们从一个简单的例子开始吧。要创建文件，请使用你惯用的文本编辑器（kate，nano，vi，……），然后创建名为note.sh的文件，里面写入这些命令：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">echo </span><span class="str">"Phone number ?"</span></pre>
<h2>如何运行/执行脚本？</h2>
<p>在保存文件后，我们可以使用bash命令来运行，把我们的文件作为它的参数：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> bash note</span><span class="pun">.</span><span class="pln">sh
</span><span class="typ">Phone</span><span class="pln"> number </span><span class="pun">?</span></pre>
<p>实际上，这样来执行脚本是很不方便的。如果不使用<strong>bash</strong>命令作为前缀来执行，会更舒服一些。要让脚本可执行，我们可以使用<strong>chmod</strong>命令：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> ls </span><span class="pun">-</span><span class="pln">la note</span><span class="pun">.</span><span class="pln">sh
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln">r</span><span class="pun">--.</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> root root </span><span class="lit">22</span><span class="pln"> </span><span class="typ">Apr</span><span class="pln"> </span><span class="lit">23</span><span class="pln"> </span><span class="lit">20</span><span class="pun">:</span><span class="lit">52</span><span class="pln"> note</span><span class="pun">.</span><span class="pln">sh
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> chmod </span><span class="pun">+</span><span class="pln">x note</span><span class="pun">.</span><span class="pln">sh
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> ls </span><span class="pun">-</span><span class="pln">la note</span><span class="pun">.</span><span class="pln">sh
</span><span class="pun">-</span><span class="pln">rwxr</span><span class="pun">-</span><span class="pln">xr</span><span class="pun">-</span><span class="pln">x</span><span class="pun">.</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> root root </span><span class="lit">22</span><span class="pln"> </span><span class="typ">Apr</span><span class="pln"> </span><span class="lit">23</span><span class="pln"> </span><span class="lit">20</span><span class="pun">:</span><span class="lit">52</span><span class="pln"> note</span><span class="pun">.</span><span class="pln">sh
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p><img src="./Shell脚本编程初体验 _ 菜鸟教程_files/Capture.png" alt="Shell脚本编程初体验"></p>
<p><strong>注意</strong> ： ls命令显示了当前文件夹内的文件。通过添加-la键，它会显示更多文件信息。</p>
<p>如我们所见，在<strong>chmod</strong>命令执行前，脚本只有读（r）和写（w）权限。在执行<strong>chmod +x</strong>后，它就获得了执行（x）权限。（关于权限的更多细节，我会在下一篇文章中讲述。）现在，我们只需这么来运行：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> </span><span class="pun">./</span><span class="pln">note</span><span class="pun">.</span><span class="pln">sh
</span><span class="typ">Phone</span><span class="pln"> number </span><span class="pun">?</span></pre>
<p>在脚本名前，我添加了 ./ 组合。.(点）在unix世界中意味着当前位置（当前文件夹），/（斜线）是文件夹分隔符。（在Windows系统中，我们使用反斜线 / 表示同样功能）所以，这整个组合的意思是说："从当前文件夹执行note.sh脚本"。我想，如果我用完整路径来运行这个脚本的话，你会更加清楚一些：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> </span><span class="pun">/</span><span class="pln">root</span><span class="pun">/</span><span class="pln">note</span><span class="pun">.</span><span class="pln">sh
</span><span class="typ">Phone</span><span class="pln"> number </span><span class="pun">?</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>它也能工作。</p>
<p>如果所有linux用户都有相同的默认shell，那就万事OK。如果我们只是执行该脚本，默认的用户shell就会用于解析脚本内容并运行命令。不同的shell的语法、内部命令等等有着一丁点不同，所以，为了保证我们的脚本会使用<strong>bash</strong>，我们应该添加<strong>#!/bin/bash</strong>到文件首行。这样，默认的用户shell将调用<strong>/bin/bash</strong>，而只有在那时候，脚本中的命令才会被执行：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat note</span><span class="pun">.</span><span class="pln">sh
</span><span class="com">#!/bin/bash</span><span class="pln">
echo </span><span class="str">"Phone number ?"</span></pre>
<p>直到现在，我们才100%确信<strong>bash</strong>会用来解析我们的脚本内容。让我们继续。</p>
<h2>读取输入</h2>
<p>在显示信息后，脚本会等待用户回答。有个<strong>read</strong>命令用来接收用户的回答：</p>
<pre class="prettyprint prettyprinted" style=""><span class="com">#!/bin/bash</span><span class="pln">
echo </span><span class="str">"Phone number ?"</span><span class="pln">
read phone</span></pre>
<p>在执行后，脚本会等待用户输入，直到用户按[ENTER]键结束输入：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> </span><span class="pun">./</span><span class="pln">note</span><span class="pun">.</span><span class="pln">sh
</span><span class="typ">Phone</span><span class="pln"> number </span><span class="pun">?</span><span class="pln">
</span><span class="lit">12345</span><span class="pln">                               </span><span class="pun">&lt;---</span><span class="pln"> </span><span class="pun">这儿是我输入的内容</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>你输入的所有东西都会被存储到变量<strong>phone</strong>中，要显示变量的值，我们同样可以使用<strong>echo</strong>命令：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat note</span><span class="pun">.</span><span class="pln">sh
</span><span class="com">#!/bin/bash</span><span class="pln">
echo </span><span class="str">"Phone number ?"</span><span class="pln">
read phone
echo </span><span class="str">"You have entered $phone as a phone number"</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> </span><span class="pun">./</span><span class="pln">note</span><span class="pun">.</span><span class="pln">sh
</span><span class="typ">Phone</span><span class="pln"> number </span><span class="pun">?</span><span class="pln">
</span><span class="lit">123456</span><span class="pln">
</span><span class="typ">You</span><span class="pln"> have entered </span><span class="lit">123456</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> a phone number
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>在<strong>bash</strong> shell中，一般我们使用<strong>$</strong>（美元）符号来表明这是一个变量，除了读入到变量和其它为数不多的时候才不用这个$（将在今后说明）。</p>
<p>好了，现在我们准备添加剩下的问题了：</p>
<pre class="prettyprint prettyprinted" style=""><span class="com">#!/bin/bash</span><span class="pln">
echo </span><span class="str">"Phone number?"</span><span class="pln">
read phone
echo </span><span class="str">"Name?"</span><span class="pln">
read name
echo </span><span class="str">"Issue?"</span><span class="pln">
read issue
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> </span><span class="pun">./</span><span class="pln">note</span><span class="pun">.</span><span class="pln">sh
</span><span class="typ">Phone</span><span class="pln"> number</span><span class="pun">?</span><span class="pln">
</span><span class="lit">123</span><span class="pln">
</span><span class="typ">Name</span><span class="pun">?</span><span class="pln">
</span><span class="typ">Jim</span><span class="pln">
</span><span class="typ">Issue</span><span class="pun">?</span><span class="pln">
script </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> working</span><span class="pun">.</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<h2>使用流重定向</h2>
<p>太完美了！剩下来就是重定向所有东西到文件data.txt了。作为字段分隔符，我们将使用/（斜线）符号。</p>
<p><strong>注意</strong> ： 你可以选择任何你认为是最好的分隔符，但是确保文件内容不会包含这些符号在内，否则它会导致在文本行中产生额外字段。</p>
<p>别忘了使用"&gt;&gt;"来代替"&gt;"，因为我们想要将输出内容附加到文件末！</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> tail </span><span class="pun">-</span><span class="lit">2</span><span class="pln"> note</span><span class="pun">.</span><span class="pln">sh
read issue
echo </span><span class="str">"$phone/$name/$issue"</span><span class="pun">&gt;&gt;</span><span class="pln">data</span><span class="pun">.</span><span class="pln">txt
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> </span><span class="pun">./</span><span class="pln">note</span><span class="pun">.</span><span class="pln">sh
</span><span class="typ">Phone</span><span class="pln"> number</span><span class="pun">?</span><span class="pln">
</span><span class="lit">987</span><span class="pln">
</span><span class="typ">Name</span><span class="pun">?</span><span class="pln">
</span><span class="typ">Jimmy</span><span class="pln">
</span><span class="typ">Issue</span><span class="pun">?</span><span class="pln">
</span><span class="typ">Keybord</span><span class="pln"> issue</span><span class="pun">.</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat data</span><span class="pun">.</span><span class="pln">txt
</span><span class="lit">987</span><span class="pun">/</span><span class="typ">Jimmy</span><span class="pun">/</span><span class="typ">Keybord</span><span class="pln"> issue</span><span class="pun">.</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p><strong>注意</strong> ： <strong>tail</strong>命令显示了文件的最后的<strong>n</strong>行。</p>
<p>搞定。让我们再来运行一次看看：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> </span><span class="pun">./</span><span class="pln">note</span><span class="pun">.</span><span class="pln">sh
</span><span class="typ">Phone</span><span class="pln"> number</span><span class="pun">?</span><span class="pln">
</span><span class="lit">556</span><span class="pln">
</span><span class="typ">Name</span><span class="pun">?</span><span class="pln">
</span><span class="typ">Janine</span><span class="pln">
</span><span class="typ">Issue</span><span class="pun">?</span><span class="pln">
</span><span class="typ">Mouse</span><span class="pln"> was broken</span><span class="pun">.</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat data</span><span class="pun">.</span><span class="pln">txt
</span><span class="lit">987</span><span class="pun">/</span><span class="typ">Jimmy</span><span class="pun">/</span><span class="typ">Keybord</span><span class="pln"> issue</span><span class="pun">.</span><span class="pln">
</span><span class="lit">556</span><span class="pun">/</span><span class="typ">Janine</span><span class="pun">/</span><span class="typ">Mouse</span><span class="pln"> was broken</span><span class="pun">.</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>我们的文件在增长，让我们在每行前面加个日期吧，这对于今后摆弄这些统计数据时会很有用。要实现这功能，我们可以使用date命令，并指定某种格式，因为我不喜欢默认格式：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> date
</span><span class="typ">Thu</span><span class="pln"> </span><span class="typ">Apr</span><span class="pln"> </span><span class="lit">23</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">33</span><span class="pun">:</span><span class="lit">14</span><span class="pln"> EEST </span><span class="lit">2015</span><span class="pln">                     </span><span class="pun">&lt;----</span><span class="pln"> date</span><span class="pun">命令的默认输出</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> date </span><span class="str">"+%Y.%m.%d %H:%M:%S"</span><span class="pln">
</span><span class="lit">2015.04</span><span class="pun">.</span><span class="lit">23</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">33</span><span class="pun">:</span><span class="lit">18</span><span class="pln">                               </span><span class="pun">&lt;----</span><span class="pln"> </span><span class="pun">格式化后的输出</span></pre>
<p>有几种方式可以读取命令的输出到变量，在这种简单的情况下，我们将使用`（是反引号，不是单引号，和波浪号~在同一个键位）：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat note</span><span class="pun">.</span><span class="pln">sh
</span><span class="com">#!/bin/bash</span><span class="pln">
now</span><span class="pun">=</span><span class="str">`date "+%Y.%m.%d %H:%M:%S"`</span><span class="pln">
echo </span><span class="str">"Phone number?"</span><span class="pln">
read phone
echo </span><span class="str">"Name?"</span><span class="pln">
read name
echo </span><span class="str">"Issue?"</span><span class="pln">
read issue
echo </span><span class="str">"$now/$phone/$name/$issue"</span><span class="pun">&gt;&gt;</span><span class="pln">data</span><span class="pun">.</span><span class="pln">txt
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> </span><span class="pun">./</span><span class="pln">note</span><span class="pun">.</span><span class="pln">sh
</span><span class="typ">Phone</span><span class="pln"> number</span><span class="pun">?</span><span class="pln">
</span><span class="lit">123</span><span class="pln">
</span><span class="typ">Name</span><span class="pun">?</span><span class="pln">
</span><span class="typ">Jim</span><span class="pln">
</span><span class="typ">Issue</span><span class="pun">?</span><span class="pln">
</span><span class="typ">Script</span><span class="pln"> hanging</span><span class="pun">.</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat data</span><span class="pun">.</span><span class="pln">txt
</span><span class="lit">2015.04</span><span class="pun">.</span><span class="lit">23</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">38</span><span class="pun">:</span><span class="lit">56</span><span class="pun">/</span><span class="lit">123</span><span class="pun">/</span><span class="typ">Jim</span><span class="pun">/</span><span class="typ">Script</span><span class="pln"> hanging</span><span class="pun">.</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>嗯…… 我们的脚本看起来有点丑啊，让我们来美化一下。如果你要手动读取<strong>read</strong>命令，你会发现read命令也可以显示一些信息。要实现该功能，我们应该使用-p键加上信息：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat note</span><span class="pun">.</span><span class="pln">sh
</span><span class="com">#!/bin/bash</span><span class="pln">
now</span><span class="pun">=</span><span class="str">`date "+%Y.%m.%d %H:%M:%S"`</span><span class="pln">
read </span><span class="pun">-</span><span class="pln">p </span><span class="str">"Phone number: "</span><span class="pln"> phone
read </span><span class="pun">-</span><span class="pln">p </span><span class="str">"Name: "</span><span class="pln"> name
read </span><span class="pun">-</span><span class="pln">p </span><span class="str">"Issue: "</span><span class="pln"> issue
echo </span><span class="str">"$now/$phone/$name/$issue"</span><span class="pun">&gt;&gt;</span><span class="pln">data</span><span class="pun">.</span><span class="pln">txt</span></pre>
<p>你可以直接从控制台查找到各个命令的大量有趣的信息，只需输入：<strong>man read, man echo, man date, man ……</strong></p>
<p>同意吗？它看上去是舒服多了！</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> </span><span class="pun">./</span><span class="pln">note</span><span class="pun">.</span><span class="pln">sh
</span><span class="typ">Phone</span><span class="pln"> number</span><span class="pun">:</span><span class="pln"> </span><span class="lit">321</span><span class="pln">
</span><span class="typ">Name</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Susane</span><span class="pln">
</span><span class="typ">Issue</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Mouse</span><span class="pln"> was stolen
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat data</span><span class="pun">.</span><span class="pln">txt
</span><span class="lit">2015.04</span><span class="pun">.</span><span class="lit">23</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">38</span><span class="pun">:</span><span class="lit">56</span><span class="pun">/</span><span class="lit">123</span><span class="pun">/</span><span class="typ">Jim</span><span class="pun">/</span><span class="typ">Script</span><span class="pln"> hanging</span><span class="pun">.</span><span class="pln">
</span><span class="lit">2015.04</span><span class="pun">.</span><span class="lit">23</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">43</span><span class="pun">:</span><span class="lit">50</span><span class="pun">/</span><span class="lit">321</span><span class="pun">/</span><span class="typ">Susane</span><span class="pun">/</span><span class="typ">Mouse</span><span class="pln"> was stolen
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>光标在消息的后面（不是在新的一行中），这有点意思。（LCTT 译注：如果用 echo 命令输出显示的话，可以用 -n 参数来避免换行。）</p>
<h2>循环</h2>
<p>是时候来改进我们的脚本了。如果用户一整天都在接电话，如果每次都要去运行，这岂不是很麻烦？让我们让这些活动都永无止境地循环去吧：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat note</span><span class="pun">.</span><span class="pln">sh
</span><span class="com">#!/bin/bash</span><span class="pln">
</span><span class="kwd">while</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="kwd">do</span><span class="pln">
        read </span><span class="pun">-</span><span class="pln">p </span><span class="str">"Phone number: "</span><span class="pln"> phone
        now</span><span class="pun">=</span><span class="str">`date "+%Y.%m.%d %H:%M:%S"`</span><span class="pln">
        read </span><span class="pun">-</span><span class="pln">p </span><span class="str">"Name: "</span><span class="pln"> name
        read </span><span class="pun">-</span><span class="pln">p </span><span class="str">"Issue: "</span><span class="pln"> issue
        echo </span><span class="str">"$now/$phone/$name/$issue"</span><span class="pun">&gt;&gt;</span><span class="pln">data</span><span class="pun">.</span><span class="pln">txt
</span><span class="kwd">done</span></pre>
<p>我已经交换了<strong>read phone</strong>和<strong>now=date</strong>行的位置。这是因为我想要在输入电话号码后再获得时间。如果我把它放在循环的首行，那么循环一次后，变量 now 就会在数据存储到文件中后马上获得时间。而这并不好，因为下一次呼叫可能在20分钟后，甚至更晚。</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> </span><span class="pun">./</span><span class="pln">note</span><span class="pun">.</span><span class="pln">sh
</span><span class="typ">Phone</span><span class="pln"> number</span><span class="pun">:</span><span class="pln"> </span><span class="lit">123</span><span class="pln">
</span><span class="typ">Name</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Jim</span><span class="pln">
</span><span class="typ">Issue</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Script</span><span class="pln"> still </span><span class="kwd">not</span><span class="pln"> works</span><span class="pun">.</span><span class="pln">
</span><span class="typ">Phone</span><span class="pln"> number</span><span class="pun">:</span><span class="pln"> </span><span class="lit">777</span><span class="pln">
</span><span class="typ">Name</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Daniel</span><span class="pln">
</span><span class="typ">Issue</span><span class="pun">:</span><span class="pln"> I broke </span><span class="kwd">my</span><span class="pln"> monitor
</span><span class="typ">Phone</span><span class="pln"> number</span><span class="pun">:</span><span class="pln"> </span><span class="pun">^</span><span class="pln">C
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat data</span><span class="pun">.</span><span class="pln">txt
</span><span class="lit">2015.04</span><span class="pun">.</span><span class="lit">23</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">38</span><span class="pun">:</span><span class="lit">56</span><span class="pun">/</span><span class="lit">123</span><span class="pun">/</span><span class="typ">Jim</span><span class="pun">/</span><span class="typ">Script</span><span class="pln"> hanging</span><span class="pun">.</span><span class="pln">
</span><span class="lit">2015.04</span><span class="pun">.</span><span class="lit">23</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">43</span><span class="pun">:</span><span class="lit">50</span><span class="pun">/</span><span class="lit">321</span><span class="pun">/</span><span class="typ">Susane</span><span class="pun">/</span><span class="typ">Mouse</span><span class="pln"> was stolen
</span><span class="lit">2015.04</span><span class="pun">.</span><span class="lit">23</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">47</span><span class="pun">:</span><span class="lit">55</span><span class="pun">/</span><span class="lit">123</span><span class="pun">/</span><span class="typ">Jim</span><span class="pun">/</span><span class="typ">Script</span><span class="pln"> still </span><span class="kwd">not</span><span class="pln"> works</span><span class="pun">.</span><span class="pln">
</span><span class="lit">2015.04</span><span class="pun">.</span><span class="lit">23</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">48</span><span class="pun">:</span><span class="lit">16</span><span class="pun">/</span><span class="lit">777</span><span class="pun">/</span><span class="typ">Daniel</span><span class="pun">/</span><span class="pln">I broke </span><span class="kwd">my</span><span class="pln"> monitor
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>注意： 要从无限循环中退出，你可以按[Ctrl]+[C]键。Shell会显示^表示 CTRL 键<sup>。</sup></p>
<h2>使用管道重定向</h2>
<p>让我们添加更多功能到我们的"弗兰肯斯坦（Frankenstein）"，我想要脚本在每次呼叫后显示某个统计数据。比如说，我想要查看各个号码呼叫了我几次。对于这个，我们应该cat文件data.txt：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat data</span><span class="pun">.</span><span class="pln">txt
</span><span class="lit">2015.04</span><span class="pun">.</span><span class="lit">23</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">38</span><span class="pun">:</span><span class="lit">56</span><span class="pun">/</span><span class="lit">123</span><span class="pun">/</span><span class="typ">Jim</span><span class="pun">/</span><span class="typ">Script</span><span class="pln"> hanging</span><span class="pun">.</span><span class="pln">
</span><span class="lit">2015.04</span><span class="pun">.</span><span class="lit">23</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">43</span><span class="pun">:</span><span class="lit">50</span><span class="pun">/</span><span class="lit">321</span><span class="pun">/</span><span class="typ">Susane</span><span class="pun">/</span><span class="typ">Mouse</span><span class="pln"> was stolen
</span><span class="lit">2015.04</span><span class="pun">.</span><span class="lit">23</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">47</span><span class="pun">:</span><span class="lit">55</span><span class="pun">/</span><span class="lit">123</span><span class="pun">/</span><span class="typ">Jim</span><span class="pun">/</span><span class="typ">Script</span><span class="pln"> still </span><span class="kwd">not</span><span class="pln"> works</span><span class="pun">.</span><span class="pln">
</span><span class="lit">2015.04</span><span class="pun">.</span><span class="lit">23</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">48</span><span class="pun">:</span><span class="lit">16</span><span class="pun">/</span><span class="lit">777</span><span class="pun">/</span><span class="typ">Daniel</span><span class="pun">/</span><span class="pln">I broke </span><span class="kwd">my</span><span class="pln"> monitor
</span><span class="lit">2015.04</span><span class="pun">.</span><span class="lit">23</span><span class="pln"> </span><span class="lit">22</span><span class="pun">:</span><span class="lit">02</span><span class="pun">:</span><span class="lit">14</span><span class="pun">/</span><span class="lit">123</span><span class="pun">/</span><span class="typ">Jimmy</span><span class="pun">/</span><span class="typ">New</span><span class="pln"> script also </span><span class="kwd">not</span><span class="pln"> working</span><span class="pun">!!!</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>现在，所有输出我们都可以重定向到<strong>cut</strong>命令，让<strong>cut</strong>来把每行切成一块一块（我们使用分隔符"/"），然后打印第二个字段：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat data</span><span class="pun">.</span><span class="pln">txt </span><span class="pun">|</span><span class="pln"> cut </span><span class="pun">-</span><span class="pln">d</span><span class="str">"/"</span><span class="pln"> </span><span class="pun">-</span><span class="pln">f2
</span><span class="lit">123</span><span class="pln">
</span><span class="lit">321</span><span class="pln">
</span><span class="lit">123</span><span class="pln">
</span><span class="lit">777</span><span class="pln">
</span><span class="lit">123</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>现在，我们可以把这个输出重定向打另外一个命令<strong>sort</strong>：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat data</span><span class="pun">.</span><span class="pln">txt </span><span class="pun">|</span><span class="pln"> cut </span><span class="pun">-</span><span class="pln">d</span><span class="str">"/"</span><span class="pln"> </span><span class="pun">-</span><span class="pln">f2</span><span class="pun">|</span><span class="pln">sort
</span><span class="lit">123</span><span class="pln">
</span><span class="lit">123</span><span class="pln">
</span><span class="lit">123</span><span class="pln">
</span><span class="lit">321</span><span class="pln">
</span><span class="lit">777</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>然后只留下唯一的行。要统计唯一条目，只需添加<strong>-c</strong>键到<strong>uniq</strong>命令：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> cat data</span><span class="pun">.</span><span class="pln">txt </span><span class="pun">|</span><span class="pln"> cut </span><span class="pun">-</span><span class="pln">d</span><span class="str">"/"</span><span class="pln"> </span><span class="pun">-</span><span class="pln">f2 </span><span class="pun">|</span><span class="pln"> sort </span><span class="pun">|</span><span class="pln"> uniq </span><span class="pun">-</span><span class="pln">c
    </span><span class="lit">3</span><span class="pln"> </span><span class="lit">123</span><span class="pln">
    </span><span class="lit">1</span><span class="pln"> </span><span class="lit">321</span><span class="pln">
    </span><span class="lit">1</span><span class="pln"> </span><span class="lit">777</span><span class="pln">
</span><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span></pre>
<p>只要把这个添加到我们的循环的最后：</p>
<pre class="prettyprint prettyprinted" style=""><span class="com">#!/bin/bash</span><span class="pln">
</span><span class="kwd">while</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="kwd">do</span><span class="pln">
        read </span><span class="pun">-</span><span class="pln">p </span><span class="str">"Phone number: "</span><span class="pln"> phone
        now</span><span class="pun">=</span><span class="str">`date "+%Y.%m.%d %H:%M:%S"`</span><span class="pln">
        read </span><span class="pun">-</span><span class="pln">p </span><span class="str">"Name: "</span><span class="pln"> name
        read </span><span class="pun">-</span><span class="pln">p </span><span class="str">"Issue: "</span><span class="pln"> issue
        echo </span><span class="str">"$now/$phone/$name/$issue"</span><span class="pun">&gt;&gt;</span><span class="pln">data</span><span class="pun">.</span><span class="pln">txt
        echo </span><span class="str">"===== We got calls from ====="</span><span class="pln">
        cat data</span><span class="pun">.</span><span class="pln">txt </span><span class="pun">|</span><span class="pln"> cut </span><span class="pun">-</span><span class="pln">d</span><span class="str">"/"</span><span class="pln"> </span><span class="pun">-</span><span class="pln">f2 </span><span class="pun">|</span><span class="pln"> sort </span><span class="pun">|</span><span class="pln"> uniq </span><span class="pun">-</span><span class="pln">c
        echo </span><span class="str">"--------------------------------"</span><span class="pln">
</span><span class="kwd">done</span></pre>
<p>运行：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">[</span><span class="pln">root@localhost </span><span class="pun">~]#</span><span class="pln"> </span><span class="pun">./</span><span class="pln">note</span><span class="pun">.</span><span class="pln">sh
</span><span class="typ">Phone</span><span class="pln"> number</span><span class="pun">:</span><span class="pln"> </span><span class="lit">454</span><span class="pln">
</span><span class="typ">Name</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Malini</span><span class="pln">
</span><span class="typ">Issue</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Windows</span><span class="pln"> license expired</span><span class="pun">.</span><span class="pln">
</span><span class="pun">=====</span><span class="pln"> </span><span class="typ">We</span><span class="pln"> got calls </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">=====</span><span class="pln">
    </span><span class="lit">3</span><span class="pln"> </span><span class="lit">123</span><span class="pln">
    </span><span class="lit">1</span><span class="pln"> </span><span class="lit">321</span><span class="pln">
    </span><span class="lit">1</span><span class="pln"> </span><span class="lit">454</span><span class="pln">
    </span><span class="lit">1</span><span class="pln"> </span><span class="lit">777</span><span class="pln">
</span><span class="pun">--------------------------------</span><span class="pln">
</span><span class="typ">Phone</span><span class="pln"> number</span><span class="pun">:</span><span class="pln"> </span><span class="pun">^</span><span class="pln">C</span></pre>
<p><img src="./Shell脚本编程初体验 _ 菜鸟教程_files/113726pspohsviiozpmdnd.png" alt="Shell脚本编程初体验"></p>
<p>当前场景贯穿了几个熟知的步骤：</p>
<ul>
<li>显示消息</li>
<li>获取用户输入</li>
<li>存储值到文件</li>
<li>处理存储的数据</li>
</ul>
<p>但是，如果用户有点责任心，他有时候需要输入数据，有时候需要统计，或者可能要在存储的数据中查找一些东西呢？对于这些事情，我们需要使用switches/cases，并知道怎样来很好地格式化输出。这对于在shell中"画"表格的时候很有用。</p>

<p>来源：http://linux.cn/article-5591-1.html</p>				</div>
			</div>
			<div class="previous-next-links">
			<div class="previous-design-link">← <a href="http://www.runoob.com/w3cnote/java-encryption.html" rel="prev"> Java中4大基本加密算法解析</a> </div>
			<div class="next-design-link"><a href="http://www.runoob.com/w3cnote/web-app-tips.html" rel="next"> Web APP开发技巧总结</a> →</div>
			</div>
			<div class="article-heading-ad" id="w3cnote-ad728">
				<script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<!-- 移动版 自动调整 -->
			<ins class="adsbygoogle" style="display:inline-block;min-width:300px;max-width:970px;width:100%;height:90px" data-ad-client="ca-pub-5751451760833794" data-ad-slot="1691338467" data-ad-format="horizontal"></ins>
			<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
			</script>

			</div>
			<style>
			@media screen and (max-width: 768px) {
		    #w3cnote-ad728 {
		        display: none;
		    }

}
			</style>
		</div>
		
	</div>
	<div class="listcol last right-column">




	<div class="tab tab-light-blue"> 订阅</div>
	<div class="sidebar-box">
		<div class="socialicons">
			<a href="http://www.runoob.com/feed" class="rss">RSS 订阅</a>
		
			<form action="http://list.qq.com/cgi-bin/qf_compose_send" method="post">
			<input type="hidden" value="qf_booked_feedback" name="t">
			<input type="hidden" value="4b67b6b6c1f5e792559940cab4aebb8f1126fba880bff1a8" name="id">
			<input class="placeholder" id="feed_email" name="to" value="输入邮箱 订阅笔记" autocomplete="off">
			<input type="submit" value="订阅" class="btn btn-primary">
			</form>
		
		</div>
 
	</div>
		


	<div class="sidebar-box cate-list">
	 	<div class="sidebar-box advertise-here list-link">
			<a href="javascript:void(0);">笔记分类</a>
		</div>
		<div class="cate-items"> 
<a href="http://www.runoob.com/w3cnote_genre/android" target="_blank" title="Android 基础入门教程">Android 基础入门教程</a><a href="http://www.runoob.com/w3cnote_genre/android-advance" target="_blank" title="Android 扩展教程">Android 扩展教程</a><a href="http://www.runoob.com/w3cnote_genre/jmr" target="_blank" title="JMR 使用教程">JMR 使用教程</a><a href="http://www.runoob.com/w3cnote_genre/phpsnippets" target="_blank" title="PHP 常用实例">PHP 常用实例</a><a href="http://www.runoob.com/w3cnote_genre/python-%e5%b8%b8%e7%94%a8%e5%ae%9e%e4%be%8b" target="_blank" title="Python 常用实例">Python 常用实例</a><a href="http://www.runoob.com/w3cnote_genre/net-2" target="_blank" title="互联网">互联网</a><a href="http://www.runoob.com/w3cnote_genre/disorganized" target="_blank" title="杂乱无章">杂乱无章</a><a href="http://www.runoob.com/w3cnote_genre/tech" target="_blank" title="科技资讯">科技资讯</a><a href="http://www.runoob.com/w3cnote_genre/coderlife" target="_blank" title="程序员人生">程序员人生
